<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated BioMedical Services</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --biocode-primary: #4CAF50;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .app-header {
            background-color: var(--primary-color);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* HemoAI Styles */
        .upload-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .preview-container {
            width: 100%;
            height: 300px;
            margin-bottom: 1.5rem;
            border: 2px dashed #ddd;
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .image-preview {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .upload-placeholder {
            text-align: center;
            cursor: pointer;
            color: #777;
            padding: 1rem;
        }

        .report-content p {
            margin-bottom: 0.5rem;
            padding: 0.3rem 0;
        }

        .report-title {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .recommendation-title {
            font-weight: 600;
            color: var(--accent-color);
            margin-top: 1rem !important;
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: #f9f9f9;
        }

        .message {
            margin-bottom: 1rem;
            padding: 0.8rem;
            border-radius: 6px;
            max-width: 80%;
        }

        .message.user {
            background-color: var(--light-color);
            margin-left: auto;
            border: 1px solid #ddd;
        }

        .message.assistant {
            background-color: var(--secondary-color);
            color: white;
            margin-right: auto;
        }

        /* BioCode Styles */
        .biocode-card {
            border-left: 4px solid var(--biocode-primary);
        }

        .biocode-btn {
            background-color: var(--biocode-primary);
            border-color: var(--biocode-primary);
        }

        .biocode-btn:hover {
            background-color: #3e8e41;
            border-color: #3e8e41;
        }

        #mutation-rate {
            width: 100%;
        }

        #risk-chart {
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        /* Tab styling */
        .nav-tabs .nav-link {
            color: var(--primary-color);
            font-weight: 500;
        }

        .nav-tabs .nav-link.active {
            color: var(--secondary-color);
            font-weight: 600;
            border-bottom: 3px solid var(--secondary-color);
        }

        /* Document Capture Styles */
        .camera-preview {
            background-color: #000;
            border-radius: 8px;
        }

        .document-preview {
            min-height: 200px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            background-color: #f8f9fa;
        }

        .capture-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .capture-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>Integrated BioMedical Services</h1>
            <p>Advanced medical analysis tools powered by AI and blockchain</p>
        </header>

        <div class="main-content">
            <ul class="nav nav-tabs" id="servicesTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="hemo-tab" data-bs-toggle="tab" data-bs-target="#hemo" type="button" role="tab">HemoAI</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="biocode-tab" data-bs-toggle="tab" data-bs-target="#biocode" type="button" role="tab">BioCode</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="genetics-tab" data-bs-toggle="tab" data-bs-target="#genetics" type="button" role="tab">Genetics</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="monitoring-tab" data-bs-toggle="tab" data-bs-target="#monitoring" type="button" role="tab">Monitoring</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button" role="tab">Documents</button>
                </li>
            </ul>

            <div class="tab-content" id="servicesTabContent">
                <!-- HemoAI Tab -->
                <div class="tab-pane fade show active" id="hemo" role="tabpanel">
                    <div class="upload-section">
                        <div class="preview-container" id="previewContainer">
                            <div class="upload-placeholder" onclick="document.getElementById('fileInput').click()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                <span>Click to upload blood sample image</span>
                                <input type="file" id="fileInput" onchange="handleFileChange(event)" accept="image/*" style="display: none;">
                            </div>
                        </div>

                        <div class="input-group mb-3">
                            <label for="phone" class="form-label">WhatsApp Number:</label>
                            <input type="tel" class="form-control" id="phone" placeholder="+1234567890" oninput="updatePhoneNumber(this.value)">
                        </div>

                        <div class="input-group mb-3">
                            <label for="userId" class="form-label">Patient ID (optional):</label>
                            <input type="text" class="form-control" id="userId" placeholder="Unique identifier" oninput="updateUserId(this.value)">
                        </div>

                        <button id="analyzeButton" onclick="handleUpload()" disabled class="btn btn-primary analyze-button w-100">
                            Analyze Sample
                        </button>
                    </div>

                    <div id="reportSection" class="report-section hidden mt-4">
                        <div class="card">
                            <div class="card-body">
                                <h2 class="card-title">Analysis Report</h2>
                                <div class="report-content" id="reportContent"></div>
                            </div>
                        </div>

                        <div class="card mt-4">
                            <div class="card-body">
                                <h3 class="card-title">Ask About Your Results</h3>
                                <div class="chat-messages" id="chatMessages"></div>
                                <div class="chat-input d-flex mt-3">
                                    <input type="text" class="form-control" id="chatInput" placeholder="Ask about your results..." onkeypress="handleChatKeyPress(event)">
                                    <button class="btn btn-primary ms-2" onclick="handleSendMessage()">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BioCode Tab -->
                <div class="tab-pane fade" id="biocode" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card biocode-card">
                                <div class="card-body">
                                    <h3 class="card-title">Mutation Simulation</h3>
                                    <div class="mb-3">
                                        <label for="dna-sequence" class="form-label">DNA Sequence (single line):</label>
                                        <input type="text" class="form-control" id="dna-sequence" value="ATGCTAGCTAGGCTA" maxlength="50">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="mutation-rate" class="form-label">Mutation Rate (%): <span id="mutation-rate-value">1%</span></label>
                                        <input type="range" class="form-range" id="mutation-rate" min="0" max="100" value="1">
                                    </div>
                                    
                                    <button class="btn biocode-btn w-100" onclick="simulateMutations()">Simulate Mutations</button>
                                    
                                    <h4 class="mt-3">Mutated Sequence:</h4>
                                    <pre id="mutated-sequence" class="p-3 bg-light rounded"></pre>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card biocode-card">
                                <div class="card-body">
                                    <h3 class="card-title">BioCode Design</h3>
                                    <div class="mb-3">
                                        <label for="binary-data" class="form-label">Binary Data (max 8 bits):</label>
                                        <input type="text" class="form-control" id="binary-data" value="1010" pattern="[01]{1,8}" title="Up to 8 binary digits (0 or 1)">
                                    </div>
                                    
                                    <button class="btn biocode-btn w-100" onclick="encodeBinary()">Encode to DNA</button>
                                    
                                    <h4 class="mt-3">Encoded Data:</h4>
                                    <pre id="encoded-data" class="p-3 bg-light rounded"></pre>
                                    
                                    <h4>DNA Sequence:</h4>
                                    <pre id="dna-codons" class="p-3 bg-light rounded"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Genetics Tab -->
                <div class="tab-pane fade" id="genetics" role="tabpanel">
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">1. Select Genetic Disease</h5>
                                    <select id="disease-selector" class="form-select">
                                        <option value="">Select a disease</option>
                                        <option value="Cystic Fibrosis">Cystic Fibrosis</option>
                                        <option value="Sickle Cell Anemia">Sickle Cell Anemia</option>
                                        <option value="Huntington's Disease">Huntington's Disease</option>
                                        <option value="Tay-Sachs Disease">Tay-Sachs Disease</option>
                                        <option value="Hemophilia">Hemophilia</option>
                                        <option value="Duchenne Muscular Dystrophy">Duchenne Muscular Dystrophy</option>
                                        <option value="Phenylketonuria (PKU)">Phenylketonuria (PKU)</option>
                                        <option value="Thalassemia">Thalassemia</option>
                                        <option value="Familial Hypercholesterolemia">Familial Hypercholesterolemia</option>
                                        <option value="BRCA-related Cancer">BRCA-related Cancer</option>
                                        <option value="Keloid Disorder">Keloid Disorder</option>
                                    </select>
                                    
                                    <div class="mt-3" id="gene-selection-container" style="display: none;">
                                        <label class="form-label">Associated Gene:</label>
                                        <select id="gene-selector" class="form-select">
                                            <option value="">Select a gene</option>
                                        </select>
                                        <div id="gene-sequence" class="mt-3" style="word-break: break-all;"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-body">
                                    <h5 class="card-title">2. Simulate SNP</h5>
                                    <form id="snp-form">
                                        <div class="mb-3">
                                            <label class="form-label">Position in Sequence</label>
                                            <input type="number" id="snp-position" class="form-control" min="0" value="0">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">New Base (A/T/C/G)</label>
                                            <select id="snp-mutation" class="form-select">
                                                <option value="A">A</option>
                                                <option value="T">T</option>
                                                <option value="C">C</option>
                                                <option value="G">G</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Generate SNP</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">3. Functional Impact Prediction</h5>
                                    <div id="functional-prediction">
                                        <p class="text-muted">Please generate a SNP first</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-body">
                                    <h5 class="card-title">4. CRISPR Design</h5>
                                    <div id="crispr-design">
                                        <p class="text-muted">CRISPR guide RNA will appear here after SNP generation</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-body">
                                    <h5 class="card-title">5. IP-NFT Management</h5>
                                    <div id="ipnft-status">
                                        <p class="text-muted">Register your SNP discovery as an IP-NFT on blockchain</p>
                                        <button id="register-ipnft" class="btn btn-success" disabled>Register IP-NFT</button>
                                        <div id="ipnft-result" class="mt-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monitoring Tab -->
                <div class="tab-pane fade" id="monitoring" role="tabpanel">
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Heart Rate Monitor</h5>
                                    <video id="video" width="100%" autoplay muted></video>
                                    <canvas id="canvas" style="display: none;"></canvas>
                                    <div id="heart-rate" class="mt-2">Heart Rate: -- BPM</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Patient Health Data</h5>
                                    <canvas id="health-chart"></canvas>
                                    <div id="health-metrics" class="mt-3">
                                        <p><strong>Last Reading:</strong> <span id="last-reading">No data</span></p>
                                        <p><strong>Average BPM:</strong> <span id="avg-bpm">--</span></p>
                                        <p><strong>Status:</strong> <span id="health-status" class="badge bg-secondary">Unknown</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Documents Tab -->
                <div class="tab-pane fade" id="documents" role="tabpanel">
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-body">
                                    <h2 class="card-title">Medical Document Capture</h2>
                                    
                                    <div class="form-group">
                                        <label for="docType">Document Type</label>
                                        <select class="form-control document-type-selector" id="docType">
                                            <option value="birth">Birth Record</option>
                                            <option value="death">Death Record</option>
                                            <option value="medical">Medical Certificate</option>
                                            <option value="prescription">Prescription</option>
                                            <option value="lab">Lab Report</option>
                                        </select>
                                    </div>
                                    
                                    <div class="camera-container mt-3" id="cameraContainer">
                                        <video class="camera-preview w-100" id="cameraPreview" autoplay></video>
                                    </div>
                                    
                                    <div class="capture-buttons mt-3">
                                        <button class="btn btn-primary" id="startCameraBtn" onclick="initCamera()">
                                            <i class="fas fa-camera me-2"></i>Start Camera
                                        </button>
                                        <button class="btn btn-success" id="captureBtn" onclick="captureDocument()" disabled>
                                            <i class="fas fa-camera-retro me-2"></i>Capture Document
                                        </button>
                                        <button class="btn btn-info" id="uploadBtn" onclick="uploadToBlockchain()" disabled>
                                            <i class="fas fa-link me-2"></i>Store in Blockchain
                                        </button>
                                    </div>
                                    
                                    <div class="document-preview mt-3" id="documentPreview"></div>
                                    <div id="blockchainStatus" class="mt-3"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="app-footer mt-4">
            <div class="container">
                <p class="text-center text-muted">
                    Integrated BioMedical Services - Combining AI, genetics, and blockchain for advanced healthcare
                </p>
            </div>
        </footer>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- PDF-lib for document processing -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>

    <script>
        // ========== HemoAI Functionality ==========
        const hemoState = {
            file: null,
            preview: null,
            phoneNumber: '',
            userId: '',
            isAnalyzing: false,
            report: null,
            chatMessage: '',
            conversation: []
        };

        // DOM elements
        const hemoElements = {
            previewContainer: document.getElementById('previewContainer'),
            analyzeButton: document.getElementById('analyzeButton'),
            reportSection: document.getElementById('reportSection'),
            reportContent: document.getElementById('reportContent'),
            chatMessages: document.getElementById('chatMessages'),
            chatInput: document.getElementById('chatInput')
        };

        // Event handlers
        function handleFileChange(event) {
            const file = event.target.files[0];
            if (file) {
                hemoState.file = file;
                const reader = new FileReader();
                reader.onloadend = () => {
                    hemoState.preview = reader.result;
                    renderPreview();
                };
                reader.readAsDataURL(file);
                updateAnalyzeButton();
            }
        }

        function updatePhoneNumber(value) {
            hemoState.phoneNumber = value;
            updateAnalyzeButton();
        }

        function updateUserId(value) {
            hemoState.userId = value;
        }

        function updateAnalyzeButton() {
            hemoElements.analyzeButton.disabled = !(hemoState.file && hemoState.phoneNumber);
        }

        function renderPreview() {
            if (hemoState.preview) {
                hemoElements.previewContainer.innerHTML = `
                    <img src="${hemoState.preview}" alt="Preview" class="image-preview">
                    <button onclick="clearImage()" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                        ×
                    </button>
                `;
            } else {
                hemoElements.previewContainer.innerHTML = `
                    <div class="upload-placeholder" onclick="document.getElementById('fileInput').click()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <span>Click to upload blood sample image</span>
                    </div>
                    <input type="file" id="fileInput" onchange="handleFileChange(event)" accept="image/*" style="display: none;">
                `;
            }
        }

        function clearImage() {
            hemoState.file = null;
            hemoState.preview = null;
            renderPreview();
            updateAnalyzeButton();
        }

        async function handleUpload() {
            if (!hemoState.file || !hemoState.phoneNumber) {
                alert('Please select an image and provide your phone number');
                return;
            }

            hemoState.isAnalyzing = true;
            hemoState.report = null;
            hemoElements.analyzeButton.disabled = true;
            hemoElements.analyzeButton.textContent = 'Analyzing...';

            // Simulate API call
            setTimeout(() => {
                checkForReport(hemoState.userId || hemoState.phoneNumber);
            }, 3000);
        }

        function checkForReport(userIdentifier) {
            // Simulate getting report from backend
            hemoState.report = `🔬 Blood Analysis Report for ${userIdentifier}\n\n• Healthy RBCs: 850\n• WBCs: 45\n• Platelets: 210\n• Abnormal Findings:\n  - Leukemia Cells: 0\n  - Malaria Parasites: 0\n  - Sickle Cells: 12\n\n💡 Clinical Recommendations:\nMild sickle cell presence detected. Recommend:\n1. Hydration therapy\n2. Pain management plan\n3. Follow-up in 2 weeks`;
            
            hemoState.conversation = [{ role: 'system', content: hemoState.report }];
            renderReport();
            
            hemoState.isAnalyzing = false;
            hemoElements.analyzeButton.disabled = false;
            hemoElements.analyzeButton.textContent = 'Analyze Sample';
        }

        function renderReport() {
            hemoElements.reportSection.classList.remove('hidden');
            hemoElements.reportContent.innerHTML = hemoState.report
                .split('\n')
                .map(line => {
                    if (line.includes('🔬')) {
                        return `<p class="report-title">${line}</p>`;
                    } else if (line.includes('💡')) {
                        return `<p class="recommendation-title">${line}</p>`;
                    }
                    return `<p>${line}</p>`;
                })
                .join('');
            
            renderConversation();
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                handleSendMessage();
            }
        }

        function handleSendMessage() {
            const message = hemoElements.chatInput.value.trim();
            if (!message) return;

            hemoState.chatMessage = message;
            hemoElements.chatInput.value = '';
            
            // Add user message to conversation
            hemoState.conversation.push({ role: 'user', content: message });
            renderConversation();
            
            // Simulate AI response
            setTimeout(() => {
                const aiResponse = `Based on your report showing 12 sickle cells, I recommend:\n\n1. Increase fluid intake to 3L/day\n2. Take folic acid supplements\n3. Monitor for pain crises\n\nWould you like me to connect you with a hematologist?`;
                hemoState.conversation.push({ role: 'assistant', content: aiResponse });
                renderConversation();
            }, 1000);
        }

        function renderConversation() {
            hemoElements.chatMessages.innerHTML = hemoState.conversation
                .map(msg => {
                    const content = msg.content.split('\n').map(p => `<p>${p}</p>`).join('');
                    return `<div class="message ${msg.role}">${content}</div>`;
                })
                .join('');
            
            // Scroll to bottom
            hemoElements.chatMessages.scrollTop = hemoElements.chatMessages.scrollHeight;
        }

        // ========== BioCode Functionality ==========
        // Mutation simulation
        function simulateMutations() {
            const sequence = document.getElementById('dna-sequence').value.toUpperCase();
            const mutationRate = parseInt(document.getElementById('mutation-rate').value) / 100;
            
            if (!/^[ATCG]+$/.test(sequence)) {
                alert("Please enter a valid DNA sequence (only A, T, C, G)");
                return;
            }

            const mutatedSequence = sequence
                .split('')
                .map(nucleotide => Math.random() < mutationRate ? randomBase(nucleotide) : nucleotide)
                .join('');
            
            document.getElementById('mutated-sequence').textContent = mutatedSequence;
        }

        // Random base generator (excludes input base)
        function randomBase(exclude) {
            const bases = ['A', 'T', 'C', 'G'].filter(base => base !== exclude);
            return bases[Math.floor(Math.random() * bases.length)];
        }

        // Binary to DNA encoding
        function encodeBinary() {
            const binaryData = document.getElementById('binary-data').value;
            
            if (!/^[01]+$/.test(binaryData) || binaryData.length > 8) {
                alert("Please enter valid binary data (max 8 bits, 0 or 1 only)");
                return;
            }

            // Simple encoding scheme
            const codonMap = {
                '00': 'AAA',
                '01': 'AAT',
                '10': 'AAC',
                '11': 'AAG',
                '0': 'AA',
                '1': 'AT'
            };

            let encoded = '';
            for (let i = 0; i < binaryData.length; i += 2) {
                const bits = binaryData.slice(i, i+2);
                encoded += codonMap[bits] || codonMap[bits[0]];
            }

            document.getElementById('encoded-data').textContent = binaryData;
            document.getElementById('dna-codons').textContent = encoded;
        }

        // Update mutation rate display
        document.getElementById('mutation-rate').addEventListener('input', function() {
            document.getElementById('mutation-rate-value').textContent = this.value + '%';
        });

        // ========== Genetics Functionality ==========
        const diseaseGenes = {
            'Cystic Fibrosis': ['CFTR'],
            'Sickle Cell Anemia': ['HBB'],
            'Huntington\'s Disease': ['HTT'],
            'Tay-Sachs Disease': ['HEXA'],
            'Hemophilia': ['F8', 'F9'],
            'Duchenne Muscular Dystrophy': ['DMD'],
            'Phenylketonuria (PKU)': ['PAH'],
            'Thalassemia': ['HBA1', 'HBA2', 'HBB'],
            'Familial Hypercholesterolemia': ['LDLR', 'APOB', 'PCSK9'],
            'BRCA-related Cancer': ['BRCA1', 'BRCA2'],
            'Keloid Disorder': ['TGFB3', 'ASH1L', 'NEDD4', 'FOXL2', 'SMAD3']
        };

        const geneSequences = {
            'CFTR': 'ATGGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAG',
            'HBB': 'ATGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAG',
            'HTT': 'ATGCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCG',
            'HEXA': 'ATGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCG',
            'F8': 'ATGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAG',
            'F9': 'ATGGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAG',
            'DMD': 'ATGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAG',
            'PAH': 'ATGCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCG',
            'HBA1': 'ATGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCG',
            'HBA2': 'ATGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAG',
             'LDLR': 'ATGGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAG',
            'APOB': 'ATGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAG',
            'PCSK9': 'ATGCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCG',
            'BRCA1': 'ATGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCG',
            'BRCA2': 'ATGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAG',
            'TGFB3': 'ATGGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAG',
            'ASH1L': 'ATGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAG',
            'NEDD4': 'ATGCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCG',
            'FOXL2': 'ATGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCGATCG',
            'SMAD3': 'ATGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAG'
        };

        const geneFunctions = {
            'CFTR': 'Encodes the cystic fibrosis transmembrane conductance regulator, a chloride channel',
            'HBB': 'Encodes the beta subunit of hemoglobin, mutations cause sickle cell disease',
            'HTT': 'Huntingtin protein, expanded CAG repeats cause Huntington\'s disease',
            'HEXA': 'Hexosaminidase A enzyme, deficiency causes Tay-Sachs disease',
            'F8': 'Coagulation factor VIII, deficiency causes Hemophilia A',
            'F9': 'Coagulation factor IX, deficiency causes Hemophilia B',
            'DMD': 'Dystrophin protein, mutations cause Duchenne muscular dystrophy',
            'PAH': 'Phenylalanine hydroxylase, deficiency causes Phenylketonuria (PKU)',
            'HBA1': 'Alpha-1 globin chain, mutations cause alpha-thalassemia',
            'HBA2': 'Alpha-2 globin chain, mutations cause alpha-thalassemia',
            'LDLR': 'Low-density lipoprotein receptor, mutations cause familial hypercholesterolemia',
            'APOB': 'Apolipoprotein B, mutations cause familial hypercholesterolemia',
            'PCSK9': 'Proprotein convertase subtilisin/kexin type 9, affects LDL receptor degradation',
            'BRCA1': 'Breast cancer type 1 susceptibility protein',
            'BRCA2': 'Breast cancer type 2 susceptibility protein',
            'TGFB3': 'Encodes transforming growth factor beta 3, involved in tissue repair and fibrosis',
            'ASH1L': 'Histone-lysine N-methyltransferase involved in chromatin regulation',
            'NEDD4': 'E3 ubiquitin-protein ligase involved in protein degradation',
            'FOXL2': 'Forkhead transcription factor important for ovarian development',
            'SMAD3': 'Signal transducer and transcriptional modulator in TGF-beta pathway'
        };

        document.getElementById('disease-selector').addEventListener('change', function() {
            const disease = this.value;
            const geneSelector = document.getElementById('gene-selector');
            const geneContainer = document.getElementById('gene-selection-container');
            
            if (disease) {
                // Clear previous options
                geneSelector.innerHTML = '<option value="">Select a gene</option>';
                
                // Add new options
                diseaseGenes[disease].forEach(gene => {
                    const option = document.createElement('option');
                    option.value = gene;
                    option.textContent = gene;
                    geneSelector.appendChild(option);
                });
                
                // Show gene selection
                geneContainer.style.display = 'block';
            } else {
                // Hide gene selection
                geneContainer.style.display = 'none';
                document.getElementById('gene-sequence').textContent = '';
            }
        });

        document.getElementById('gene-selector').addEventListener('change', function() {
            const gene = this.value;
            if (gene) {
                document.getElementById('gene-sequence').textContent = geneSequences[gene];
                document.getElementById('snp-position').max = geneSequences[gene].length - 1;
            } else {
                document.getElementById('gene-sequence').textContent = '';
            }
        });

        document.getElementById('snp-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const gene = document.getElementById('gene-selector').value;
            const position = parseInt(document.getElementById('snp-position').value);
            const mutation = document.getElementById('snp-mutation').value;
            
            if (!gene) {
                alert('Please select a gene first');
                return;
            }
            
            const sequence = geneSequences[gene];
            if (position >= sequence.length) {
                alert('Position is out of range for this gene');
                return;
            }
            
            const originalBase = sequence[position];
            const mutatedSequence = sequence.substring(0, position) + mutation + sequence.substring(position + 1);
            
            // Display functional impact
            const impact = predictFunctionalImpact(gene, position, originalBase, mutation);
            document.getElementById('functional-prediction').innerHTML = `
                <p><strong>Original Sequence:</strong> ${sequence}</p>
                <p><strong>Mutated Sequence:</strong> ${mutatedSequence}</p>
                <p><strong>Mutation:</strong> ${originalBase}${position+1}${mutation}</p>
                <p><strong>Gene Function:</strong> ${geneFunctions[gene]}</p>
                <p><strong>Predicted Impact:</strong> ${impact}</p>
            `;
            
            // Generate CRISPR design
            const crispr = designCRISPR(gene, position, mutation);
            document.getElementById('crispr-design').innerHTML = `
                <p><strong>Guide RNA:</strong> ${crispr.guideRNA}</p>
                <p><strong>Target Sequence:</strong> ${crispr.targetSequence}</p>
                <p><strong>Repair Template:</strong> ${crispr.repairTemplate}</p>
            `;
            
            // Enable IP-NFT registration
            document.getElementById('register-ipnft').disabled = false;
        });

        function predictFunctionalImpact(gene, position, original, mutation) {
            // Simplified prediction algorithm
            const impacts = [
                "Likely benign - no significant functional impact expected",
                "Possibly damaging - may affect protein function moderately",
                "Probably damaging - likely to affect protein function significantly",
                "Pathogenic - known disease-causing mutation"
            ];
            
            const severity = (gene.length + position + original.charCodeAt(0) + mutation.charCodeAt(0)) % 4;
            return impacts[severity];
        }

        function designCRISPR(gene, position, mutation) {
            const sequence = geneSequences[gene];
            const target = sequence.substring(Math.max(0, position-10), Math.min(sequence.length, position+10));
            const pam = 'NGG';
            
            return {
                guideRNA: target + pam,
                targetSequence: sequence.substring(position-5, position+5),
                repairTemplate: sequence.substring(position-5, position) + mutation + sequence.substring(position+1, position+5)
            };
        }

        document.getElementById('register-ipnft').addEventListener('click', function() {
            const gene = document.getElementById('gene-selector').value;
            const position = document.getElementById('snp-position').value;
            const mutation = document.getElementById('snp-mutation').value;
            
            document.getElementById('ipnft-result').innerHTML = `
                <div class="alert alert-info">
                    <p>Registering IP-NFT for ${gene} mutation at position ${position} (${mutation})...</p>
                    <p>Transaction hash: 0x${Math.random().toString(16).substr(2, 10)}...${Math.random().toString(16).substr(2, 4)}</p>
                    <p>IP-NFT successfully minted!</p>
                    <p>View on blockchain explorer: <a href="#" target="_blank">https://explorer.example.com/tx/0x123...abc</a></p>
                </div>
            `;
            
            this.disabled = true;
        });

        // ========== Monitoring Functionality ==========
        
        // Heart rate monitoring code
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const heartRateDisplay = document.getElementById('heart-rate');
        const ctx = canvas.getContext('2d');

        let redChannelData = [];
        let heartRateInterval;
        const FRAME_RATE = 30;
        const SAMPLE_WINDOW = 10 * FRAME_RATE;

        async function startVideo() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                video.srcObject = stream;
                video.play();
                processFrames();
            } catch (err) {
                console.error('Error accessing camera:', err);
                alert('Please allow camera access for heart rate monitoring.');
            }
        }

        function processFrames() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            heartRateInterval = setInterval(() => {
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                const imageData = ctx.getImageData(
                    canvas.width / 2 - 10,
                    canvas.height / 2 - 10,
                    20,
                    20
                );
                const redChannel = extractRedChannel(imageData.data);
                const avgRed = redChannel.reduce((sum, val) => sum + val, 0) / redChannel.length;

                redChannelData.push(avgRed);
                if (redChannelData.length > SAMPLE_WINDOW) {
                    redChannelData.shift();
                }

                if (redChannelData.length === SAMPLE_WINDOW) {
                    const bpm = calculateHeartRate(redChannelData);
                    heartRateDisplay.textContent = `Heart Rate: ${bpm} BPM`;
                }
            }, 1000 / FRAME_RATE);
        }

        function extractRedChannel(pixelData) {
            const redChannel = [];
            for (let i = 0; i < pixelData.length; i += 4) {
                redChannel.push(pixelData[i]);
            }
            return redChannel;
        }

        function calculateHeartRate(data) {
            // Simplified heart rate calculation
            let maxIndex = 0;
            let maxMagnitude = 0;
            for (let i = 0; i < data.length; i++) {
                if (data[i] > maxMagnitude) {
                    maxMagnitude = data[i];
                    maxIndex = i;
                }
            }
            const frequency = maxIndex * (FRAME_RATE / data.length);
            return Math.round(frequency * 60);
        }

        window.onload = startVideo;
    
			
			
			 // ========== Document Capture System ==========
        let mediaStream = null;
        let capturedDocument = null;
        
        // DOM elements
        const docElements = {
            cameraPreview: document.getElementById('cameraPreview'),
            startCameraBtn: document.getElementById('startCameraBtn'),
            captureBtn: document.getElementById('captureBtn'),
            uploadBtn: document.getElementById('uploadBtn'),
            documentPreview: document.getElementById('documentPreview'),
            blockchainStatus: document.getElementById('blockchainStatus')
        };

        // Initialize camera
        async function initCamera() {
            try {
                // Check for camera support
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('Camera API not supported in this browser');
                }
                
                // Request camera access
                mediaStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: false
                });
                
                // Display camera stream
                docElements.cameraPreview.srcObject = mediaStream;
                docElements.cameraPreview.style.display = 'block';
                docElements.captureBtn.disabled = false;
                docElements.startCameraBtn.disabled = true;
                
                // Handle camera errors
                docElements.cameraPreview.onerror = () => {
                    showError('Failed to load camera stream');
                    stopCamera();
                };
                
            } catch (error) {
                showError(`Camera Error: ${error.message}`);
                console.error('Camera initialization failed:', error);
            }
        }

        // Capture document image
        async function captureDocument() {
            try {
                if (!mediaStream) {
                    throw new Error('Camera not initialized');
                }
                
                const video = docElements.cameraPreview;
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // Draw video frame to canvas
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // Create document object
                capturedDocument = {
                    type: document.getElementById('docType').value,
                    timestamp: new Date().toISOString(),
                    imageData: canvas.toDataURL('image/jpeg', 0.9),
                    metadata: {
                        resolution: `${canvas.width}x${canvas.height}`,
                        device: navigator.userAgent
                    }
                };
                
                // Display preview
                docElements.documentPreview.innerHTML = `
                    <img src="${capturedDocument.imageData}" alt="Captured Document" class="img-thumbnail">
                    <p class="mt-2">Document ready for blockchain storage</p>
                `;
                
                docElements.uploadBtn.disabled = false;
                stopCamera();
                
            } catch (error) {
                showError(`Capture Error: ${error.message}`);
                console.error('Document capture failed:', error);
            }
        }

        // Upload to blockchain via MindsDB
        async function uploadToBlockchain() {
            if (!capturedDocument) {
                showError('No document captured');
                return;
            }
            
            try {
                // Show loading state
                docElements.uploadBtn.disabled = true;
                docElements.blockchainStatus.innerHTML = `
                    <div class="d-flex align-items-center text-primary">
                        <div class="spinner-border spinner-border-sm me-2" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <span>Processing document...</span>
                    </div>
                `;
                
                // Convert to PDF
                const { PDFDocument } = PDFLib;
                const pdfDoc = await PDFDocument.create();
                const page = pdfDoc.addPage([600, 800]);
                
                // Embed the image
                const imageBytes = await fetch(capturedDocument.imageData)
                    .then(res => res.arrayBuffer());
                const image = await pdfDoc.embedJpg(imageBytes);
                
                // Draw image on PDF
                const { width, height } = image.scale(0.5);
                page.drawImage(image, {
                    x: 50,
                    y: 600 - height,
                    width,
                    height
                });
                
                // Add metadata
                page.drawText(`Document Type: ${capturedDocument.type}`, { x: 50, y: 750 });
                page.drawText(`Capture Time: ${new Date(capturedDocument.timestamp).toLocaleString()}`, { x: 50, y: 730 });
                
                // Save PDF
                const pdfBytes = await pdfDoc.save();
                
                // In a real implementation, you would send to MindsDB blockchain API
                // This is a simulation for demonstration purposes
                simulateBlockchainUpload(pdfBytes);
                
            } catch (error) {
                showError(`Processing Error: ${error.message}`);
                console.error('Document processing failed:', error);
                docElements.uploadBtn.disabled = false;
            }
        }

        // Simulate blockchain upload (replace with actual MindsDB API call)
        function simulateBlockchainUpload(pdfBytes) {
            setTimeout(() => {
                // Generate fake transaction hash
                const txHash = `0x${Array(64).fill(0).map(() => 
                    Math.floor(Math.random() * 16).toString(16)).join('')}`;
                
                // Update UI with success
                docElements.blockchainStatus.innerHTML = `
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        Document successfully stored in blockchain!
                        <div class="mt-2">
                            <small>Transaction Hash:</small>
                            <div class="text-truncate">${txHash}</div>
                        </div>
                    </div>
                `;
                
                // Reset capture state
                capturedDocument = null;
                docElements.documentPreview.innerHTML = '';
                docElements.uploadBtn.disabled = true;
                docElements.captureBtn.disabled = true;
                docElements.startCameraBtn.disabled = false;
                
                // In a real app, you would also update the patient timeline
                console.log('Document stored in blockchain:', {
                    type: capturedDocument.type,
                    timestamp: capturedDocument.timestamp,
                    transaction: txHash
                });
                
            }, 3000);
        }

        // Stop camera stream
        function stopCamera() {
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }
            docElements.cameraPreview.srcObject = null;
            docElements.cameraPreview.style.display = 'none';
        }

        // Show error message
        function showError(message) {
            docElements.blockchainStatus.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    ${message}
                </div>
            `;
        }

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            stopCamera();
        });
      </script>
</body>
</html>
